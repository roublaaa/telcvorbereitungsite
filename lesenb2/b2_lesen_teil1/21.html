
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Lesen Teil 1 - Benzin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ========================================= */
    /*        1. PROFESSIONAL CSS VARIABLES      */
    /* ========================================= */
    :root {
      /* Palette: Professional Indigo & Slate */
      --primary: #1e293b;       /* Indigo */
      --primary-soft: #e0e7ff;
      --bg-body: #f8fafc;       /* Slate-50 */
      --surface: #ffffff;
      
      --text-main: #1e293b;     /* Slate-800 */
      
      --success: #10b981;       /* Emerald */
      --success-bg: #d1fae5;
      --error: #ef4444;         /* Red */
      --error-bg: #fee2e2;

      /* Dimensions & Spacing */
      --radius: 12px;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      
      /* FIXED DIMENSIONS */
      --header-height: 60px;
      --mobile-answer-height: 140px; /* INCREASED height for long text */
    }

    *, *::before, *::after { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      margin: 0; padding: 0;
      background-color: var(--bg-body);
      color: var(--text-main);
      min-height: 100vh;
      line-height: 1.5;
    }

    /* ========================================= */
    /*           2. HEADER (FIXED)               */
    /* ========================================= */
    .main-header {
      position: fixed;
      top: 0; left: 0; width: 100%;
      height: var(--header-height);
      
      background: var(--primary); /* Opaque enough to hide scroll */
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      
      border-bottom: 1px solid rgba(0,0,0,0.05);
      color: var(--surface);
      z-index: 2000; /* Highest Layer */
      
      display: flex; align-items: center; justify-content: center;
      font-weight: 800; font-size: 1.1rem;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    /* ========================================= */
    /*           3. LAYOUT CONTAINER             */
    /* ========================================= */
    .container {
      max-width: 1280px;
      margin: 0 auto;
      
      /* Dynamic Top Padding: Header + Spacing */
      padding-top: calc(var(--header-height) + 40px);
      padding-bottom: 60px;
      padding-left: 24px; padding-right: 24px;
      
      display: flex;
      gap: 40px;
      align-items: flex-start;
    }

    /* ========================================= */
    /*        4. LEFT COLUMN (QUESTIONS)         */
    /* ========================================= */
    .left-column {
      width: 60%;
      flex-shrink: 0;
    }

    .question-box {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 30px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-sm);
      border: 1px solid #e2e8f0;
    }

    .question-text {
      font-size: 1rem;
      color: #334155;
      margin-top: 20px;
    }

    /* DROP ZONES */
    .email-fields { margin-bottom: 15px; }

    .drop-target {
      background-color: #f1f5f9;
      border: 2px dashed #cbd5e1;
      border-radius: 12px;
      min-height: 64px;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s ease;
      cursor: pointer;
      position: relative;
    }

    .drop-target.empty-drop-target::before {
      content: "Hier Antwort ablegen";
      color: #94a3b8; font-size: 0.9rem; font-weight: 600;
      pointer-events: none;
    }

    .drop-target.drag-over {
      background-color: var(--primary-soft);
      border-color: var(--primary);
      transform: scale(1.01);
    }

    /* DROPPED ITEMS (Inside Question) */
    .drop-target .draggable {
      border: none; background: transparent; padding: 5px; text-align: center;
      color: var(--primary); width: 100%; box-shadow: none;
      font-weight: 700; margin: 0; font-size: 0.95rem;
      height: auto; /* Allow auto height when dropped */
    }

    /* ========================================= */
    /*        5. RIGHT COLUMN (ANSWERS)          */
    /* ========================================= */
    .right-column {
      width: 35%;
      
      /* STICKY SIDEBAR (Desktop) */
      position: sticky; 
      top: calc(var(--header-height) + 30px); 
      height: calc(100vh - 120px);
      z-index: 1000;
    }

    .right-column-content {
      background: var(--surface);
      padding: 20px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-md);
      border: 1px solid rgba(0,0,0,0.03);
      max-height: 100%;
      overflow-y: auto;
    }

    /* DRAGGABLE CARDS */
    .draggable {
      background: white;
      border: 1px solid #e2e8f0;
      border-left: 4px solid var(--primary);
      padding: 14px 18px;
      margin-bottom: 12px;
      border-radius: 10px;
      cursor: grab;
      font-size: 0.9rem; font-weight: 500; color: #334155;
      box-shadow: 0 1px 2px rgba(0,0,0,0.04);
      transition: all 0.2s;
      user-select: none;
    }

    .draggable.selected {
      background-color: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    /* ========================================= */
    /*        6. FEEDBACK & BUTTONS              */
    /* ========================================= */
    .drop-target.correct { background: var(--success-bg) !important; border-color: var(--success) !important; }
    .drop-target.correct .draggable { color: #065f46 !important; }
    .drop-target.correct::after { content: "‚úì"; position: absolute; right: 15px; color: var(--success); font-weight: bold; }
    
    .drop-target.incorrect { background: var(--error-bg) !important; border-color: var(--error) !important; }
    .drop-target.incorrect .draggable { color: #991b1b !important; }
    .drop-target.incorrect::after { content: "‚úï"; position: absolute; right: 15px; color: var(--error); font-weight: bold; }

    /* Buttons */
    .button-container { display: flex; justify-content: center; gap: 15px; margin-top: 20px; margin-bottom: 40px; }
    
    .quiz-button, .quiz-button-link {
      background: var(--text-main); color: white !important;
      padding: 14px 32px; border-radius: 50px;
      font-weight: 600; border: none; text-decoration: none; cursor: pointer;
      display: flex; align-items: center; gap: 10px; font-size: 1rem;
      transition: all 0.2s;
      box-shadow: var(--shadow-md);
    }
    
    .quiz-button.secondary, .quiz-button-link.secondary {
      background: white; color: var(--text-main) !important;
      border: 1px solid #cbd5e1;
    }
    
    #result { text-align: center; margin-bottom: 25px; font-weight: 800; font-size: 1.25rem; }
    #result .correct-count { color: var(--success); }
    #result .total-count { color: var(--text-main); }


    /* ========================================= */
    /*           7. MOBILE RESPONSIVE            */
    /* ========================================= */

    @media (max-width: 991px) {
      
      /* 1. Header Adjustment */
      .main-header {
        font-size: 1rem;
        height: var(--header-height);
        padding: 0 10px;
      }

      /* 2. Layout: Stacked */
      .container {
        flex-direction: column;
        padding: 0;
        /* Calculate Top Padding: Header + AnswerBar + Extra Gap */
        padding-top: calc(var(--header-height) + var(--mobile-answer-height) + 20px);
      }

      /* 3. ANSWER BAR (FIXED HORIZONTAL SCROLL) */
      .right-column {
        position: fixed;
        top: var(--header-height); /* Starts immediately after header */
        left: 0; width: 100%;
        height: var(--mobile-answer-height);
        z-index: 1500;
        
        background: #f1f5f9; /* Solid background to hide content behind */
        border-bottom: 1px solid rgba(0,0,0,0.1);
        box-shadow: 0 4px 10px -2px rgba(0,0,0,0.05);
      }

      .right-column-content {
        display: flex; 
        flex-direction: row; 
        gap: 12px;
        
        /* Add padding inside the scroll area so cards don't touch edges */
        padding: 15px 16px; 
        
        height: 100%;
        width: 100%;
        background: transparent;
        border: none; box-shadow: none; border-radius: 0;
        
        /* Horizontal Scroll */
        overflow-x: auto; 
        overflow-y: hidden;
        white-space: normal; /* Changed from nowrap to normal to allow wrapping inside card */
        scroll-snap-type: x mandatory;
        
        align-items: flex-start; /* Align top */
      }
      
      /* Hide Scrollbar */
      .right-column-content::-webkit-scrollbar { display: none; }

      /* 4. Mobile Answer Cards */
      .draggable {
        flex: 0 0 auto; /* Don't shrink */
        width: 190px;   /* Fixed width */
        height: 100%;   /* Fill height of the container */
        margin: 0;
        
        display: flex; 
        align-items: center; 
        justify-content: center;
        text-align: center;
        
        font-size: 0.8rem;
        line-height: 1.3;
        scroll-snap-align: center;
        
        background: white;
        border: 1px solid #e2e8f0;
        border-bottom: 4px solid var(--primary); /* Accent at bottom for mobile */
        border-left: 1px solid #e2e8f0; /* Reset desktop left border */
        
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      }
      
      .draggable.selected {
        background: var(--primary);
        color: white;
        border: none;
      }

      /* 5. Left Column (Questions) */
      .left-column { width: 100%; padding: 0 16px; }
      .question-box { padding: 20px; border-radius: 12px; }

      /* 6. Buttons */
      .button-container { flex-direction: column; padding: 0 16px 0 16px; gap: 12px; margin-top: 20px; }
      .quiz-button, .quiz-button-link { width: 100%; justify-content: center; padding: 16px; }
    }
  </style>
</head>
<body>

<div class="main-header">Lesen Teil 1 - Benzin</div>

<div class="container">
  <div class="left-column">
    <div class="quiz-scroll-container">
      <!-- Question 1 -->
      <div class="question-box" data-correct="Steigende Spritpreise: die Tricks der Autofahrer.">
          <div class="email-fields">
            <div class="email-subject drop-target empty-drop-target" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
          </div>
          <div class="question-text">
        Aussteigen, tanken, wegfahren: Wenn die Benzinpreise steigen, ist wieder Hochsaison bei den Benzindieben. Fr√ºh morgens und abends schlagen sie besonders gerne zu. Viele setzen auf den Schutz der Dunkelheit. Vor Weihnachten und im Januar und Februar h√§ufen sich die F√§lle. Auch am Monatsende, wenn das Geld knapp wird, steigt die Zahl der Benzindiebst√§hle. Doch sparen l√§sst sich durch Benzinklau nicht. Fast alle T√§ter werden von der Polizei gefasst. Schlie√ülich gibt es an jeder Tankstelle eine Kamera, die das Autokennzeichen aufgenommen hat. Tankwart Kurt Jochimsen aus Emden zeigt uns einen Fall aus seiner gro√üen Videosammlung. Ein Wagen mit zwei Insassen f√§hrt an die Zapfs√§ule. Der Fahrer tankt, seine Frau geht in den Shop. Sie kauft dort zwei Cola und bezahlt ‚Äì aber nicht das Benzin. Der Mann hat inzwischen voll getankt und wartet im Wagen. "Hier sehen Sie: Die Frau kommt raus, steigt ein und das Fahrzeug f√§hrt davon. Hinterher hei√üt es dann: Ich habe doch glatt vergessen, das Benzin zu bezahlen", erkl√§rt Kurt Jochimsen. Bei der Polizei kennt man diese Ausreden. Polizeihauptkommissar Werner Knips: "Vergessen gilt nicht, es gibt immer eine Anzeige. Und dann wird es richtig teuer."
          </div>
      </div>
      <!-- Question 2 -->
      <div class="question-box" data-correct="Die wichtigsten Erste-Hilfe-Ratschl√§ge.">
          <div class="email-fields">
            <div class="email-subject drop-target empty-drop-target" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
          </div>
          <div class="question-text">
        Viele Autofahrer, die in einen Unfall verwickelt sind, sind so aufgeregt, dass sie vergessen, was zu tun ist. Der Versicherungsexperte Klaus Lenhoff gibt die wichtigsten Tipps:
        1-Unfallstelle absichern: Warnblinkanlage einschalten und Warndreieck in 100 Metern Entfernung aufstellen.
        2-Rettung aus dem Gefahrenbereich: Alle Unfallbeteiligten aus dem Gefahrenbereich retten. Eingeschlossene befreien und Br√§nde sofort bek√§mpfen.
        3-Rettungskr√§fte informieren: Bei schweren Unf√§llen und wenn es Verletzte gibt, die Polizei (Ruf 110) oder die Rettungsleitstelle (Ruf 112) informieren. Dabei an "die f√ºnf W's" denken: Wo ist es passiert? Was ist passiert? Wie viele Verletzte? Welche Verletzungen? Warten Sie auf R√ºckfragen.
        4-Verletzten Hilfe leisten, zum Beispiel: Kontrolle von Atmung und Puls, Atemspende, stabile Seitenlage, Erkennen und Behandeln eines Schocks, Stillen von Blutungen.
        5-Lokalisierung auf der Autobahn: Wo hat sich der Unfall ereignet?
        6-Beweismittel sichern: Am besten Fotos oder eine Skizze von der Unfallstelle machen.
        7-Verkehrsfluss wiederherstellen, also schnell die Fahrbahn r√§umen.
        8-Name, Anschrift und Telefonnummern von Zeugen notieren.
        9-Vorsicht bei Aussagen: Die Aufregung am Unfallort verleitet zu missverst√§ndlichen √Ñu√üerungen. Keine Aussagen unter Druck machen.
        10-Versicherung des Unfallgegners ermitteln.
        </div>
      </div>
      <!-- Question 3 -->
      <div class="question-box" data-correct="Einmal die Welt als Ganzes sehen.">
          <div class="email-fields">
            <div class="email-subject drop-target empty-drop-target" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
          </div>
          <div class="question-text">
        Hast du schon mal mit dem Gedanken gespielt, Pilotin zu werden? Nicht? Dann geht es euch wahrscheinlich wie den meisten M√§dchen oder Frauen. Warum wollen eigentlich so wenige Frauen Pilotinnen werden? Nur weil der Beruf angeblich ein typischer M√§nnerberuf ist? Wir haben eine Pilotin getroffen: Monique Bellin ist 39 Jahre alt, wohnt im S√ºden Frankfurts und ist Pilotin. "Schon seit fr√ºher Kindheit habe ich mich f√ºr die Fliegerei interessiert. Es hat mich schon immer fasziniert, dass es mit Hilfe technischer Mittel m√∂glich ist, die Schwerkraft zu √ºberwinden und die Welt aus der Vogelperspektive zu betrachten. Und irgendwann wollte ich diese Technik dann auch selbst beherrschen", so Bellin. Seit sie in diesem Beruf arbeitet, habe sich ihre Einstellung zu vielen Dingen ver√§ndert: "Ich bin toleranter als vor meinem 'Fliegerleben' ‚Äì vielleicht weil ich versuche, mein Umfeld aus anderen Perspektiven zu betrachten. Auch meine Freizeit und meine Familie sind mir noch kostbarer geworden, seit ich in diesem Beruf t√§tig bin", erkl√§rt sie. Hat sie noch Tr√§ume? "Aber ja!", sagt Monique Bellin: "Mit einem Shuttle ins Weltall fliegen, um die Erde als Kugel zu sehen und das Gef√ºhl absoluter Schwerelosigkeit zu erleben."
        </div>
      </div>
      <!-- Question 4 -->
      <div class="question-box" data-correct="Einmal um die Welt ohne einen Tropfen Benzin.">
          <div class="email-fields">
            <div class="email-subject drop-target empty-drop-target" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
          </div>
          <div class="question-text">
        Der Schweizer Louis Palmer hat eine Weltumrundung mit seinem "Solartaxi" fast abgeschlossen. Er habe bereits 47.000 km mit seinem Solarauto zur√ºckgelegt, sagte Palmer bei einem Stopp in Paris. "Nun habe ich fast den ganzen Planeten umrundet, ohne einen Tropfen Benzin zu brauchen." Die Batterien des bis zu 90 Stundenkilometer schnellen Solarmobils k√∂nnen Energie f√ºr eine Reichweite von 400 km speichern. "Das Wetter spielt keine Rolle", sagte Palmer. "Es kann mehrere Tage in Folge regnen, ich fahre ohne Probleme weiter." Palmer war mit seinem dreir√§drigen "Taxi" im Juli in Luzern gestartet. Seitdem hat er Europa, Asien, Australien, Neuseeland und Nordamerika durchquert. Er zieht einen Anh√§nger mit sechs Quadratmetern Solarzellen hinter sich her, und die Sonnenenergie treibt das Gef√§hrt an. Seit dem Start ist das Solartaxi nur zwei Tage ausgefallen, weil ein Kabel besch√§digt war. Gebaut wurde das innovative Fahrzeug von vier Schweizer Ingenieurschulen. Palmer hat auch Platz f√ºr Beifahrer: Neben ihm sa√üen schon ber√ºhmte Pers√∂nlichkeiten aus Politik, Wirtschaft und Showgesch√§ft im "Solartaxi".
        </div>
      </div>
      <!-- Question 5 -->
      <div class="question-box" data-correct="Fliegen statt fahren.">
          <div class="email-fields">
            <div class="email-subject drop-target empty-drop-target" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
          </div>
          <div class="question-text">
        Die Bundesregierung und ihre Spitzenbeamten sind auf Dienstreisen gern mit dem Flugzeug unterwegs ‚Äì aber nicht nur, wenn es um Fernreisen geht, sondern auch bei kurzen Inlandsreisen. Wie aus der Antwort des Innenministeriums auf eine Frage eines Abgeordneten hervorgeht, gab die Bundesregierung im letzten Jahr 7,7 Millionen Euro f√ºr innerdeutsche Flugreisen aus. Fahrkarten der Bahn hingegen schlugen lediglich mit 3,2 Millionen zu Buche. Der Vergleich mit anderen Jahren zeigt aber, dass sich die meisten Politiker bem√ºhen, immer h√§ufiger vom Flugzeug auf die Bahn umzusteigen. Eine Ausnahme bilden das Kanzleramt (Flugkosten um 30 % erh√∂ht gegen√ºber dem Vorjahr) sowie ausgerechnet das Ressort des Bundesumweltministers (plus 7 %). Vergleichszahlen f√ºr den erh√∂hten und gesenkten Benzinverbrauch f√ºr die Dienstwagen der Bundesregierung liegen noch nicht vor.</div>
      </div>
    </div>
  </div>

  <div class="right-column">
    <div class="right-column-content" ondrop="drop(event)" ondragover="allowDrop(event)">
      <div class="draggable" draggable="true" id="a1" ondragstart="drag(event)">Benzingeld sparen: Tipp vom Tankwart.</div>
      <div class="draggable" draggable="true" id="a2" ondragstart="drag(event)">Die wichtigsten Erste-Hilfe-Ratschl√§ge.</div>
      <div class="draggable" draggable="true" id="a3" ondragstart="drag(event)">Einmal die Welt als Ganzes sehen.</div>
      <div class="draggable" draggable="true" id="a4" ondragstart="drag(event)">Einmal um die Welt ohne einen Tropfen Benzin.</div>
      <div class="draggable" draggable="true" id="a5" ondragstart="drag(event)">Fliegen statt fahren.</div>
      <div class="draggable" draggable="true" id="a6" ondragstart="drag(event)">Innerdeutsche Reisen besonders beliebt.</div>
      <div class="draggable" draggable="true" id="a7" ondragstart="drag(event)">Frau im All.</div>
      <div class="draggable" draggable="true" id="a8" ondragstart="drag(event)">Schweizer nutzen Solartaxis.</div>
      <div class="draggable" draggable="true" id="a9" ondragstart="drag(event)">Steigende Spritpreise: die Tricks der Autofahrer.</div>
      <div class="draggable" draggable="true" id="a10" ondragstart="drag(event)">Die richtige Unfallversicherung.</div>
    </div>
  </div>
</div>

<div id="result"></div>

<div class="button-container">
  <button onclick="submitQuiz()" class="quiz-button">
    <i class="fas fa-paper-plane"></i> Abschicken
  </button>
  <button onclick="resetQuiz()" class="quiz-button secondary">
      <i class="fas fa-redo"></i> Zur√ºcksetzen
  </button>
  <a href="/b2_exam.html" class="quiz-button-link secondary"> <!-- Replace # with your actual home link -->
    <i class="fas fa-home"></i> Zur√ºck zur Startseite
  </a>
</div>



<script>
  const rightColumnContent = document.querySelector(".right-column .right-column-content");
  const originalAnswerOrder = Array.from(rightColumnContent.querySelectorAll('.draggable'));
  let selectedDraggable = null; // To store the currently click-selected draggable item

  // --- CLICK-TO-DROP/PICKUP LOGIC ---
  function selectItem(item) {
    if (selectedDraggable) {
      selectedDraggable.classList.remove('selected');
    }
    selectedDraggable = item;
    if (selectedDraggable) {
      selectedDraggable.classList.add('selected');
    }
  }

  function deselectItem() {
    if (selectedDraggable) {
      selectedDraggable.classList.remove('selected');
      selectedDraggable = null;
    }
  }

  function handleDraggableClicked(event) {
    const clickedItem = event.currentTarget;
    event.stopPropagation(); // Prevent click bubbling to parent elements like answer pool

    if (selectedDraggable === clickedItem) { // Clicking the already selected item
      deselectItem();
      // If it was in a target and now deselected by clicking it, move it back to pool
      if (clickedItem.parentElement.classList.contains('drop-target')) {
           const parentDropTarget = clickedItem.parentElement;
           rightColumnContent.appendChild(clickedItem);
           updateDropTargetVisualState(parentDropTarget);
           parentDropTarget.classList.remove('correct', 'incorrect'); // Clear feedback
      }
    } else { // Clicking a new item, or an unselected item in a target
      // If the clicked item is currently in a drop target, "pick it up" by moving to pool first
      if (clickedItem.parentElement.classList.contains('drop-target')) {
          const parentDropTarget = clickedItem.parentElement;
          rightColumnContent.appendChild(clickedItem); // Move to pool
          updateDropTargetVisualState(parentDropTarget);
          parentDropTarget.classList.remove('correct', 'incorrect'); // Clear feedback
      }
      selectItem(clickedItem); // Then select it (it's now in the pool)
    }
  }

  function handleDropTargetClicked(event) {
    const clickedDropTarget = event.currentTarget;
    event.stopPropagation();

    if (selectedDraggable) { // If an item is selected, try to place it here
      const existingItemInTarget = clickedDropTarget.querySelector('.draggable');
      if (existingItemInTarget && existingItemInTarget !== selectedDraggable) {
        rightColumnContent.appendChild(existingItemInTarget); // Move old item from target back to pool
        // No need to deselect existingItemInTarget here, as it wasn't the 'selectedDraggable'
      }

      clickedDropTarget.innerHTML = ''; // Clear target (removes placeholder or old item)
      clickedDropTarget.appendChild(selectedDraggable); // Place new item
      updateDropTargetVisualState(clickedDropTarget);
      clickedDropTarget.classList.remove('correct', 'incorrect'); // Clear any feedback
      deselectItem(); // Item is placed, so deselect
    } else if (!selectedDraggable && clickedDropTarget.querySelector('.draggable')) {
      // No item is selected, AND the clicked drop target HAS an item: "pick up" that item.
      const itemToPickUp = clickedDropTarget.querySelector('.draggable');
      rightColumnContent.appendChild(itemToPickUp); // Move it to the pool
      updateDropTargetVisualState(clickedDropTarget);
      clickedDropTarget.classList.remove('correct', 'incorrect'); // Clear feedback
      selectItem(itemToPickUp); // And select it (it's now in the pool)
    }
  }

  function handleAnswerPoolClicked(event) {
    // If click is on the pool itself (not a draggable within it) and an item is selected
    if (event.target === rightColumnContent && selectedDraggable) {
      // If selected item is somehow not in pool (e.g. if logic changes), ensure it is
      if (selectedDraggable.parentElement !== rightColumnContent) {
           rightColumnContent.appendChild(selectedDraggable);
      }
      // The main purpose here: clicking the pool with a selected item deselects it.
      deselectItem();
    }
  }

  function initializeClickInteractions() {
    document.querySelectorAll('.draggable').forEach(item => {
      item.addEventListener('click', handleDraggableClicked);
    });
    document.querySelectorAll('.drop-target').forEach(target => {
      target.addEventListener('click', handleDropTargetClicked);
    });
    rightColumnContent.addEventListener('click', handleAnswerPoolClicked);
  }

  // --- DRAG AND DROP LOGIC (MODIFIED) ---
  function allowDrop(ev) {
    ev.preventDefault();
    let potentialDropTarget = ev.target;
    while(potentialDropTarget && !potentialDropTarget.classList.contains('drop-target') && !potentialDropTarget.classList.contains('right-column-content')) {
        potentialDropTarget = potentialDropTarget.parentElement;
    }
    if (potentialDropTarget && potentialDropTarget.classList.contains('drop-target')) {
        potentialDropTarget.classList.add("drag-over");
    }
  }

  document.addEventListener('dragleave', function(event) {
    if (event.target.classList && event.target.classList.contains("drop-target")) {
      event.target.classList.remove("drag-over");
    }
  }, false);

  function drag(ev) {
    ev.dataTransfer.setData("text", ev.target.id);
    ev.target.classList.add("dragging");
    deselectItem(); // Deselect any click-selected item when a drag operation starts
  }

  document.addEventListener('dragend', function(event) {
    if (event.target.classList && event.target.classList.contains('draggable')) {
      event.target.classList.remove('dragging');
    }
    document.querySelectorAll('.drop-target.drag-over').forEach(dt => dt.classList.remove('drag-over'));
  });

  function drop(ev) {
    ev.preventDefault();
    const draggedId = ev.dataTransfer.getData("text");
    const draggedEl = document.getElementById(draggedId);
    let dropTargetEl = ev.target;

    if (!draggedEl) return; // Safety check

    draggedEl.classList.remove("dragging");
    document.querySelectorAll('.drop-target.drag-over').forEach(dt => dt.classList.remove('drag-over'));

    while (dropTargetEl &&
           !dropTargetEl.classList.contains("drop-target") &&
           !dropTargetEl.classList.contains("right-column-content")) {
      dropTargetEl = dropTargetEl.parentElement;
    }

    if (!dropTargetEl) return;

    if (dropTargetEl.classList.contains("drop-target")) {
      const currentAnswer = dropTargetEl.querySelector(".draggable");
      if (currentAnswer && currentAnswer !== draggedEl) {
        rightColumnContent.appendChild(currentAnswer);
        currentAnswer.classList.remove('selected'); // Ensure item moved back is not selected
      }
      dropTargetEl.innerHTML = "";
      dropTargetEl.appendChild(draggedEl);
      dropTargetEl.classList.remove("correct", "incorrect");
      updateDropTargetVisualState(dropTargetEl);
    }
    else if (dropTargetEl.classList.contains("right-column-content")) {
      const originalParent = draggedEl.parentElement; // Get parent BEFORE moving
      rightColumnContent.appendChild(draggedEl);
      if (originalParent && originalParent.classList.contains('drop-target')) {
          updateDropTargetVisualState(originalParent); // Update visual state of original drop target
          originalParent.classList.remove('correct', 'incorrect');
      }
    }
    deselectItem(); // Deselect any click-selected item after a drop operation
  }

  function updateDropTargetVisualState(dropTarget) {
    if (!dropTarget || !dropTarget.classList.contains('drop-target')) return;
    if (dropTarget.querySelector(".draggable")) {
      dropTarget.classList.remove("empty-drop-target");
    } else {
      dropTarget.classList.add("empty-drop-target");
    }
  }

  // --- QUIZ FUNCTIONALITY (MODIFIED RESET) ---
  function submitQuiz() {
    let total = 0;
    let correct = 0;
    deselectItem(); // Ensure nothing is selected when submitting

    document.querySelectorAll('.question-box').forEach((box) => {
      total++;
      const correctAnswer = box.getAttribute("data-correct").trim();
      const dropTarget = box.querySelector(".drop-target");
      const droppedDraggable = dropTarget.querySelector(".draggable");
      dropTarget.classList.remove("correct", "incorrect");
      if (droppedDraggable) {
        const selectedText = droppedDraggable.textContent.trim();
        if (selectedText === correctAnswer) {
          dropTarget.classList.add("correct");
          correct++;
        } else {
          dropTarget.classList.add("incorrect");
        }
      } else {
        dropTarget.classList.add("incorrect");
      }
    });
    const resultDiv = document.getElementById("result");
    resultDiv.innerHTML =
      `Du hast <span class="correct-count">${correct}</span> von <span class="total-count">${total}</span> Fragen richtig beantwortet.`;
  }

  function resetQuiz() {
    deselectItem(); // Clear any click-selection first

    document.querySelectorAll('.drop-target').forEach(dt => {
        const draggable = dt.querySelector('.draggable');
        if (draggable) {
            rightColumnContent.appendChild(draggable);
            draggable.classList.remove('selected'); // Make sure it's not selected style
        }
        dt.innerHTML = '';
        dt.classList.remove('correct', 'incorrect');
        updateDropTargetVisualState(dt);
    });

    rightColumnContent.innerHTML = '';
    originalAnswerOrder.forEach(draggable => {
        rightColumnContent.appendChild(draggable);
        draggable.classList.remove('dragging'); // Just in case
        draggable.classList.remove('selected'); // Ensure no selected style
    });

    document.getElementById("result").innerHTML = "";
    document.querySelectorAll('.drop-target').forEach(updateDropTargetVisualState);
  }

  // --- INITIALIZATION ---
  document.querySelectorAll('.drop-target').forEach(updateDropTargetVisualState);
  initializeClickInteractions(); // Add this line to set up click listeners

</script>
<script>
let pingTimeout;
let logoutTimer;
let warningTimer;
let countdownTimer;
let lastPing = 0;

const INACTIVITY_LIMIT = 15 * 60 * 1000; // 15 minutes
const WARNING_BEFORE_LOGOUT = 30 * 1000; // 30 seconds
const warningBox = document.getElementById("warningBox");
const countdownEl = document.getElementById("countdown");

function sendPing() {
    const now = Date.now();
    if (now - lastPing < 10000) return; 
    lastPing = now;
    fetch("/ping").catch(() => {});
}

function resetTimers() {
    clearTimeout(pingTimeout);
    clearTimeout(logoutTimer);
    clearTimeout(warningTimer);
    clearInterval(countdownTimer);

    warningBox.style.display = "none"; // üü° hide warning if active again

    sendPing();
    pingTimeout = setTimeout(sendPing, 60 * 1000);

    // Show warning 30s before logout
    warningTimer = setTimeout(() => {
        let remaining = 30;
        warningBox.style.display = "block";
        countdownEl.textContent = remaining;

        countdownTimer = setInterval(() => {
            remaining--;
            countdownEl.textContent = remaining;
            if (remaining <= 0) {
                clearInterval(countdownTimer);
            }
        }, 1000);
    }, INACTIVITY_LIMIT - WARNING_BEFORE_LOGOUT);

    // Auto logout
    logoutTimer = setTimeout(() => {
        fetch("/logout", { method: "POST" })
          .then(() => window.location.href = "/");
    }, INACTIVITY_LIMIT);
}

// Events
["mousemove", "keydown", "scroll", "click", "touchstart"].forEach(evt => {
    document.addEventListener(evt, resetTimers);
});

window.addEventListener("pageshow", sendPing);
window.addEventListener("beforeunload", sendPing);

resetTimers();
</script>


</body>
</html>